import sys, os
from google.cloud import bigquery
sys.path.append(os.path.dirname(os.path.realpath(__file__)) + "/../dbconnector")

import base_vn

variable='record'
schema='BASEVN_PAYROLL'
stop_words=[
        'columns_so_cong_chuan',
        'columns_luong_hieu_qua_cong_viec_cu',
        'columns_tong_phu_cap',
        'columns_cong_di_lam_thuc_te',
        'columns_nghi_phep_nam',
        'columns_ngay_le',
        'columns_ngay_nghi_viec_rieng_huong_luong',
        'columns_tong_cong_tinh_luong',
        'columns_tong_gio_cong_thuc_te',
        'columns_tong_luong_theo_cong',
        'columns_phu_cap_com_thuc_te',
        'columns_phu_cap_dien_thoai_thuc_te',
        'columns_phu_cap_di_lai_thuc_te',
        'columns_tong_phu_cap_thuc_te',
        'columns_tong_luong_thuc_te',
        'columns_so_gio_tang_ca_ngay_thuong',
        'columns_so_gio_tang_ca_ngay_nghi',
        'columns_so_gio_tang_ca_ngay_le',
        'columns_tong_luong_tang_ca',
        'columns_thuong_doanh_thu',
        'columns_thuong_cuoi_nam',
        'columns_cac_khoan_cong_them',
        'columns_tong_thu_nhap_khac',
        'columns_tong_thu_nhap',
        'columns_cac_khoan_tru_khac',
        'columns_chi_phi_bhxh_nld_dong',
        'columns_chi_phi_bhyt_nld_dong',
        'columns_chi_phi_bhtn_nld_dong',
        'columns_doan_phi',
        'columns_truy_thu_bhyt',
        'columns_tong_chi_phi_bhxh_bhyt_bhtn_nld_dong',
        'columns_chi_phi_bhxh_ct_dong',
        'columns_chi_phi_bhyt_ct_dong',
        'columns_chi_phi_bhtn_ct_dong',
        'columns_truy_thu_bhyt_ct_dong',
        'columns_tong_chi_phi_bhxh_bhyt_bhtn_ct_dong',
        'columns_thu_nhap_mien_thue',
        'columns_tong_thu_nhap_chiu_thue',
        'columns_giam_tru_ca_nhan',
        'columns_so_nguoi_phu_thuoc',
        'columns_giam_tru_nguoi_phu_thuoc',
        'columns_cac_khoan_giam_thue',
        'columns_thu_nhap_tinh_thue_tncn',
        'columns_thue_tncn',
        'columns_khoan_tru_sau_thue',
        'columns_thuc_nhan',
        'columns_trich_chi_phi_luong_thang',
        'columns_tong_col',
        'columns_phu_cap_com_cu',
        'columns_phu_cap_dien_thoai_cu',
        'columns_phu_cap_di_lai_cu',
        'columns_luong_co_ban_thu_viec',
        'columns_luong_kpi_thu_viec',
        'columns_cong_thu_viec',
        'columns_onleave_status',
        'columns_is_terminated',
        'columns_old_stage_basic_salary',
        'columns_insurance_custom_salary',
        'columns_personal_deduction',
        'columns_num_career_change',
        'columns_old_stage_salary',
        'columns_annual_tf_point',
        'columns_personal_tf_point',
        'columns_business_tf_point',
        'columns_outside_tf_point',
        'columns_unpaid_tf_point',
        'columns_other_tf_point',
        'columns_outside_hour_tf_point',
        'columns_annual_hour_tf_point',
        'columns_unpaid_hour_tf_point',
        'columns_annual_tf_shift',
        'columns_personal_tf_shift',
        'columns_business_tf_shift',
        'columns_outside_tf_shift',
        'columns_unpaid_tf_shift',
        'columns_other_tf_shift',
        'columns_outside_hour_tf_shift',
        'columns_annual_hour_tf_shift',
        'columns_unpaid_hour_tf_shift',
        'columns_annual_hour_tf_pto',
        'columns_outside_hour_tf_hour',
        'columns_annual_hour_tf_hour',
        'columns_unpaid_hour_tf_hour',
        'columns_pto',
        'columns_cto',
        'columns_overtime',
        'columns_overtime_hours',
        'columns_work_day',
        'columns_hrm_workday',
        'columns_standard_points',
        'columns_old_stage_standard_points',
        'columns_old_stage_day_points',
        'columns_day_points',
        'columns_points',
        'columns_hourly_income',
        'columns_sum_late',
        'columns_sum_addition',
        'columns_sum_deduction',
        'columns_sum_minute_late'    
]

job_config_list = bigquery.LoadJobConfig(
        schema=[
            bigquery.SchemaField("loaded_date",bigquery.enums.SqlTypeNames.TIMESTAMP)
        ]
)

query_string='select max(last_update) as last_update from `pacc-raw-data.'+schema+'.'+variable+'`'

a=base_vn.while_loop_page_insert(app='payroll',
                                 schema=schema,
                                 column_name=variable,
                                 job_config=job_config_list,
                                 stop_words=stop_words,
                                 query_string_incre=query_string
                                 )